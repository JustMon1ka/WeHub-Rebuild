# User 模块
## views
### UserGuideView
用户引导界面，主要用于让用户选择一些Tag，帮助初始的用户画像生成。用户可以选择多个Tag，系统会根据选择的Tag生成初始的用户画像。然后系统在首页会根据用户画像推荐内容。

1. 该组件有counter属性，表示用户选择的Tag数量。
2. 用户可以选择保存或者跳过。

![UserGuide](/Docs/user/Images/UserGuide.png)

### UserPageView
用户个人页面，展示用户的个人信息、关注列表、粉丝列表等。用户可以在此页面编辑自己的个人信息，包括昵称、头像、简介等。页面还会显示用户的关注和粉丝列表，用户可以在此页面查看和管理自己的关注关系。

1. 该组件接受一个`props`参数`userId_p`，用于指定要显示的用户ID。

2. 该组件主要由三部分组成：用户主界面、用户信息编辑界面和用户关注列表界面。
   - 用户主界面显示用户的基本信息和动态，使用组件`UserCardPage`
   - 用户信息编辑界面允许用户修改个人信息，使用组件`UserInfoEdit`
   - 用户关注列表界面展示用户的关注和粉丝信息，使用组件`FollowList`

3. 该组件有以下属性：
    - `userId`: 用户ID，假如传入的`userId_p`为null，则默认为当前登录用户的ID。
    - `userInfo`: UserInfo类实例，用户信息，包含昵称、头像、简介等。
    - `editMode`: 编辑模式，表示当前是否处于编辑状态。
    - `followMode`: 关注模式，表示当前是否处于关注列表中。
    - `followTab`: 关注标签，表示当前是处于关注列表还是粉丝列表。
    - `userInfoTemp`: 临时用户信息，用户在编辑状态下的临时信息。当`userInfo`加载完成后进行复制。同时，当编辑页面保存时，会将其中的内容保存到`userInfo`中；当编辑页面取消时，会将`userInfo`中的内容复制到`userInfoTemp`中。
    - `Tabs`和`tabLabels`：前者是`TabController`类实例，后者是标签名称数组，他们主要用来管理用户主界面的发帖、点赞、恢复的帖子列表的切换。

4. 对于关注列表、用户编辑页面设置了`key`，并使其与`userId`绑定，通过`watch`监视`userId_p`，每当`userId_p`发生变化时，组件会自动重新获取用户信息和关注列表，并更新`key`，这会正确触发组件重绘。

5. 用户编辑页面和用户关注列表均有滑动动画支持。

## components
### Tag/TagGuide
Tag 选择引导组件，主要用于引导用户选择合适的 Tag。scripts下的tags.json储存了所有可选的 Tag 信息。

1. 该组件定义了两个`model`
   - `counter`：用户选择的Tag数量，类型为`number`。
   - `selectedTags`：用户选择的Tag列表，类型为`Map<string, string>`

2. 该组件定义了`tagMap`一个方法，用于从`tags.json`中加载所有可选的Tag信息，并将其转换为`Map<string, Map<string, string>>`的格式，即`{tagGroup : {tagId : tagName}}`的标签分组。

### Tag/TagSetForm
Tag 选择表单组件，主要用于用户在编辑个人信息时删除/添加 Tag。该组件会显示用户当前所有已选择的标签，并允许用户进行删除，该组件还包含一个输入框，用于添加新的标签。

1. 该组件定义了两个`model`一个`emit`
   `model`
   - `selectedTags`：`model`，用户选择的Tag列表，类型为`Map<string, string>`
   - `editing`：`model`，编辑状态，类型为`boolean`，用于让上层组件改变样式。

   `emit`
   - `changed`：`emit`，标签变化状态，类型为`boolean`，用于告知上层组件标签是否发生了变化。

2. 为了监视用户是否处于编辑状态，本组件首先通过将组件的顶层元素的id设置为一个唯一id，然后通过该id在脚本中获取顶层元素，最后通过添加全局鼠标事件监听器，在回调函数中检查点击目标是否是组件的顶层元素或其子元素，如果是，则将`editing`设置为`true`，否则设置为`false`。

3. 组件为`v-for`创建的列表，将`tagId`做为索引，将`tagName`作为内容，当用户删除标签时，会通过组件的索引进行标签的删除。同时使用了vue的`TransitionGroup`组件为标签的增删提供动画效果。

### UserList/FollowButton
关注按钮组件，主要用于用户关注/取消关注其他用户。

1. 该组件定义了一个`props`两个`emit`
   `props`
   - `userId`：表示当前用户ID，类型为`string`。

   `emit`
   - `followed`：当用户点击关注按钮时触发。
   - `unfollowed`：当用户点击取消关注按钮时触发。

2. 该组件会根据`userId`的值，与User类的FollowingList和FollowerList来判断当前用户是否已关注该用户，并根据关注状态显示不同的按钮文本和样式。
   - 如果双方均未关注，则显示“关注”按钮。
   - 如果本用户已关注该用户，但该用户未关注本用户，则显示“已关注”按钮。
   - 如果本用户未关注该用户，但该用户已关注本用户，则显示“回关”按钮。
   - 如果双方均已关注，则显示“已互关”按钮。
   - 当本用户已关注对方，则在鼠标悬浮时显示“取消关注”按钮。

### UserList/UserCardHover
用户卡片悬浮组件，主要用于在用户列表中显示用户的详细信息。当用户将鼠标悬停在某个用户卡片上时，该组件会显示该用户的详细信息，包括昵称、头像、简介等。

1. 该组件定义了一个名为`userInfo`的`model`，用于存储用户的详细信息。

2. 该组件会根据`userInfo`的值，动态显示用户的详细信息，包括昵称、头像、简介等。具体信息详见`userCardPage`组件。

### UserList/UserCardList
用户列表中的卡片组件，主要用于在用户列表中显示多个用户的卡片。

1. 该组件定义了两个`prop`和两个`emit`以及一个`slot`
   `prop`
   - `userId`：表示用户ID，类型为`string`。
   - `followBtn`：表示是否需要展示关注按钮，类型为`boolean`。可省略，默认为不展示

   `emit`
   - `error`和`success`：分别在请求失败和成功时触发。错误信息将被储存在`userInfo`中。
   - `slot`：用于自定义用户卡片的主要内容。默认为用户简介。

2. 该组件会根据`userId`的值，动态加载用户信息，并在加载成功后通过`success`事件将用户信息传递给父组件。如果加载失败，则通过`error`事件将错误信息传递给父组件。

3. 当鼠标悬停在用户头像或用户名上时，组件会计算鼠标的位置，并根据其位置显示`UserCardHover`组件。

### UserList/UserList
用户列表组件，主要用于在用户列表中显示多个用户的卡片。

1. 该组件有两个`prop`
   - `generator`：表示用户列表的异步迭代器，类型为`AsyncGenerator<Array<string>, string, number>`，传入`pageSize`，返回对应大小的用户ID数组，并储存在`users`这一数组中。用于懒加载用户列表。
   - `followBtn`：表示是否需要展示关注按钮，类型为`boolean`。可省略，默认为不展示

2. 该组件会根据`generator`的值，动态加载用户信息。假如某一页超过1/3的用户信息加载失败，则认为该页加载失败。

3. 该组件会根据`users`数组的值，动态渲染用户卡片。该组件使用`IntersectionObserver`监视哨兵元素的可见性，当哨兵元素进入视口时，组件会加载下一页的用户信息。

4. 哨兵元素是一个使用`pulse`动画的加载动画组件。

### UserPage/FollowList
关注与被关注列表组件，主要用于显示用户的关注列表和粉丝列表。

1. 该组件包含两个`props`和一个`emit`
   `props`
   - `userId_p`：表示当前用户ID，类型为`string`。
   - `nickName`：表示用户的昵称，类型为`string`。

   `emit`
   - `close`：当用户点击关闭按钮时触发。

2. 该组件包含两个标签页“关注”和“粉丝”。通过`TabController`的类实例来管理标签页的切换。

3. 该组件的限制了内容区域的高度，并设置其内部使用`overflow-y: auto`进行滚动，这样就实现了`sticky`效果的滑动条。

![FollowList](/Docs/user/Images/FollowList.png)

### UserPage/UserCardPage
用户主页信息卡片组件，主要用于显示用户的基本信息，包括昵称、头像、简介等。

1. 该组件定义了一个`props`和三个`emit`
   `props`
   - `userInfo`：表示用户信息，类型为`UserInfo`。

   `emit`
   - `editProfile`：当用户点击编辑按钮时触发。
   - `toFollowing`：当用户点击正在关注人数时触发。
   - `toFollower`：当用户点击关注着人数时触发。

2. 该组件会根据`userInfo`的值，动态显示用户的基本信息，包括昵称、用户名、头像、背景、加入时间、生日、地址、关注人数、关注者人数、简介等。人数会计算为以K/M为单位的缩写。

![UserPage](/Docs/user/Images/UserPage.png)

### UserPage/UserInfoEdit
用户信息编辑组件，主要用于用户编辑个人信息。

1. 定义了一个`model`和两个`emit`:
   `model`
   - `userInfo`：表示用户信息，类型为`UserInfo`。

   `emit`
   - `editSave`：当用户点击保存按钮时触发。
   - `editCancel`：当用户点击取消按钮时触发。

2. 该组件允许用户编辑个人信息，包括昵称、头像、背景、生日、地址、简介、用户标签。

![UserInfoEdit](/Docs/user/Images/UserInfoEdit1.png)
![UserInfoEdit](/Docs/user/Images/UserInfoEdit2.png)

### PlaceHolder
用于生成用户头像占位符svg图像的组件，使用用户昵称的第一个字母作为头像，使用的配色是根据整个昵称通过某种算法生成的。当用户编辑昵称后，组件会自动更新头像。

## scripts
### UserInfo
用户信息相关的脚本，包括用户信息的获取、更新等功能。

1. 该类包含三个静态属性：
    - `errorMsg`：错误信息的合集。
    - `msgTranslation`：用于将后端返回的错误信息翻译为用户友好的提示。
    - `TagMap`：用户标签从`Id`到`Name`的映射。减少为网络请求。

2. 该类包含两个静态方法`getTagName`和`getTagId`，用于根据标签ID获取标签名称，以及根据标签名称获取标签ID。假如`TagMap`中不存在对应的标签，则从对应的API中获取。

3. 该类包含26个实例属性，其中19属性为用户数据，7个属性为状态量。
    **用户数据**
    - `userId`：用户ID。
    - `username`：用户名。
    - `createdAt`：加入时间，格式为ISO字符串的日期部分。
    - `email`：用户邮箱。
    - `phone`：用户电话。
    - `password`：用户密码。

    **用户资料**
    - `nickName`：用户昵称。
    - `avatarURL`：用户头像URL。
    - `profileURL`：用户主页URL。
    - `birthday`：用户生日。
    - `location`：用户地址。
    - `bio`：用户简介。
    - `status`：用户状态。
    - `experience`：用户经验值。
    - `level`：用户等级。
    - `gender`：用户性别。
    
    **关注人数**
    - `followingCount`：关注人数。
    - `followerCount`：粉丝人数。

    **用户标签**
    - `userTags`：用户标签列表，类型为`Map<string, string>`，即`{tagId: tagName}`的形式。

    **状态**
    - `profileLoaded`：用户资料是否加载完成，boolean类型。
    - `followLoaded`：关注列表是否加载完成，boolean类型。
    - `tagsLoaded`：用户标签是否加载完成，boolean类型。
    - `changed`：用户信息是否发生变化，boolean类型。
    - `error`：用户信息是否发生错误，boolean类型。
    - `errorMsg`：用户信息错误提示，string类型。
    - `isMe`：是否为当前用户，boolean类型。

4. 该类包含8个方法。
    - `loadUserData`：加载用户资料入口函数，依次调用`loadProfile`、`loadFollow`和`loadTags`方法。
    - `loadProfile`：加载用户个人信息。
    - `loadFollow`：加载用户关注数目。
    - `loadTags`：加载用户标签。
    - `copy`：复制用户数据，用于`UserInfoEdit`组件的编辑功能。
    - `updateProfile`：更新用户个人信息。首先检查用户输入信息的合法性：昵称为1-20个字符；简介不超过100个字符。然后调用`UserDataAPI.setUserProfileAPI`方法更新用户信息。
    - `uploadPicture`：上传用户头像或资料背景，上传前检查文件类型和大小，大小不超过3MB。
    - `handleError`：处理用户信息错误，会根据`MsgTranslation`进行错误信息的翻译。

### TabController
标签页控制器，用于管理用户主页的标签页切换。主要用于前端实现标签页的切换效果。包含两个类`TabButton`和`TabController`。

#### TabButton
标签页按钮组件，用于渲染单个标签页按钮。
1. 包含三个静态属性：
   - `label`：标签页名称。类型为响应式字符串。
   - `class`：标签页样式，采用Tailwind CSS。类型为响应式字符串。
   - `focused`：是否处于选中状态。boolean类型。

2. 包含两个方法`setFocused`和`setBlur`，用于设置标签页的选中状态。同时改变标签页的样式。

#### TabController
标签页控制器组件，用于管理多个标签页的切换逻辑。
1. 包含三个实例属性：
   - `currentTab`：当前选中的标签页索引。
   - `tabLabels`：标签页名称数组。
   - `buttons`：`TabButton`数组。

2. 包含一个方法`switchTab`，用于设置当前选中的标签页。会根据传入的索引更新`currentTab`，并调用相应标签页的`setFocused`和`setBlur`方法。

### UserDataAPI
用户数据API，主要用于与后端进行用户数据相关的交互。

包含四个API：
1. `getUserDataAPI`：获取用户信息。
2. `setUserAuthDataAPI`：设置用户认证信息，包含邮箱密码等。
3. `setUserProfileAPI`：更新用户个人信息，包含昵称、头像、背景、生日、地址、简介等。
4. `deleteUserAPI`：删除用户信息。

### UserTagAPI
用户标签API，主要用于与后端进行用户标签相关的交互。

1. `getTagsAPI`：获取用户标签列表。
2. `setTagsAPI`：设置用户标签列表。
3. `addTagAPI`：添加用户标签。
4. `deleteTagAPI`：删除用户标签。

### FetchFromAPI
包含FetchFromAPI函数，用于从API使用fetch获取数据，并进行错误处理。

### Styles
用于储存本模块通用的Tailwind CSS样式
