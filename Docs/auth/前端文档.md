# auth 模块
## views
### LoginView
登录界面，用户可以在此界面输入用户名、手机号、邮箱（Identifier）和密码或邮箱和验证码进行登录。包含登录表单和网页图标。

使用密码登录
![LoginPassword](/Docs/auth/Images/LoginByPassword.png "LoginPassword")

使用验证码登录
![LoginEmail](/Docs/auth/Images/LoginByAuthCode.png "LoginEmail")

### LoginHover
登录悬浮组件，当在router的meta中设置requiredLogin为true时，导航到该界面不会成功会弹出登录弹窗。包含登录表单和网页图标。
![LoginHover](/Docs/auth/Images/LoginHover.png "LoginHover")

### RegisterView
用途；注册界面，用户可以在此界面输入用户名、手机号、邮箱和密码进行注册。邮箱需要通过验证码进行验证才能注册成功。包含注册表单和网页图标。
![RegisterView](/Docs/auth/Images/Register.png "RegisterView")

### PasswordResetView
重置密码界面，用户可以在此界面输入邮箱和验证码进行重置密码。需要先通过邮箱验证码验证身份，然后才能设置新密码。包含重置密码表单和网页图标。
![PasswordResetView](/Docs/auth/Images/ResetPassword.png "PasswordResetView")

### PrivacyView
隐私政策界面，展示网站的隐私政策内容。
![PrivacyView](/Docs/auth/Images/Privacy.png "PrivacyView")

## components
### LoginForm
登录表单组件，用户可以在此组件中输入用户名、手机号、邮箱和密码或邮箱和验证码进行登录。包含两个界面：
  - 密码登录界面：包含用户名、手机号、邮箱、密码
  - 验证码登录界面：包含验证码输入框，以及登录按钮。

### RegisterForm
注册表单组件，用户可以在此组件中输入用户名、手机号、邮箱和密码进行注册。邮箱需要经过验证码验证。包含用户名、手机号、邮箱、验证码输入框和按钮、密码输入框，以及注册按钮。

### PasswordResetForm
重置密码表单组件，用户可以在此组件中输入邮箱和验证码进行重置密码。需要先通过邮箱验证码验证身份，然后才能设置新密码。包含两个界面：
  - 身份验证界面：邮箱输入框、验证码输入框和按钮
  - 密码重置界面：密码输入框，以及重置密码按钮

## scripts
### UserMetaData
主要用于前端。封装了所有用户进行验证时需要输入的元数据：邮箱、手机号、用户名、密码、验证码。

1. 属性：均包含两个静态属性和三个实例属性。
静态属性：
   - errorMsg：用于储存发生错误时的错误信息
   - Regex：用于验证输入的正则表达式
   实例属性：
   - `value`：此字段与类名相同，用于存储用户输入的值，是一个响应式变量。
   - error：此字段用于判断是否发生错误，是一个boolean型响应式变量。
   - errorMsg：此字段用于存储错误信息，是一个响应式变量。
2. 方法：均包含一个实例方法：
   - checkValidity：用于验证用户输入的值是否符合正则表达式规则，以及一些其他规则（是否为空等）。

#### Username：用户的用户名
1. 用户可以使用用户名进行登录或注册。
2. Regex验证规则为：`/^[a-zA-Z0-9-_]+$/`，即用户名只能包含字母、数字、下划线和连字符。
3. 另外用户名长度必须在3到20个字符之间。
4. checkEmpty方法：用户名不能为空。

#### Email：用户的邮箱地址
1. 用户可以使用邮箱地址进行登录或注册。
2. Regex验证规则为：`/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/`，即邮箱地址必须符合标准的邮箱格式。
3. 另外邮箱只允许使用常见的邮箱服务商的域名（如gmail.com、yahoo.com等），不允许使用自定义域名。

#### Phone：用户的手机号
1. 用户可以使用手机号进行登录或注册。 
2. Regex验证规则为：`/^1[3-9]\d{9}$/`，即手机号必须是11位数字，且以1开头，第二位为3-9之间的数字，即中国大陆手机号的格式。

#### Password：用户的密码
1. 用户可以使用密码进行登录或注册。 
2. Regex验证规则为：`/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d).+$/`，即密码必须包含至少一个大写字母、一个小写字母和一个数字。 
3. 另外密码长度必须在8到32个字符之间。 
4. 该类还有confirmPassword相关属性，用于保存确认密码的值和验证确认密码是否与密码一致。

#### AuthCode：用户的验证码
1. 用户可以使用验证码进行登录或注册。 
2. Regex验证规则为：`/^\d{6}$/`，即验证码必须是6位数字。 
3. sendAuthCode方法：用于发送验证码到用户的邮箱或手机号。验证码获取前需要先通过邮箱合理性检查。验证码在获取过一次后需要等待30秒才能再次获取。

### AuthData
封装了全部用户的登录或注册数据。主要用于前端表单数据的验证和提交。

1. 属性：包含2个静态属性和12个实例属性。
   **静态属性**
   - errorMsg：用于储存发生错误时的错误信息。
  
   **实例属性**
   - userMetaData类属性：username、email、phone、password、authCode，全部为实力属性，每个属性都是一个UserMetaData实例，用于验证用户输入的值是否符合规则和前端input值的双向绑定。
   - verified：用户是否已验证邮箱，用于重置密码时的身份验证。
   - rememberMe：是否记住登录状态，影响cookie的时长设置。
   - agreeToTerms：用户注册时是否同意隐私政策和服务条款，影响注册按钮的可用性。
   - authType：值为AuthType枚举类实例，可能值分别代表：
     - PasswordLogin：登录使用用户名、手机号或邮箱和密码。
     - AuthCodeLogin：登录使用邮箱和验证码。
     - Register：注册。
     - PasswordResetVerify：重置密码时的身份验证，用户需要输入邮箱和验证码。
     - PasswordReset：重置密码时设置新密码，此时用户已通过邮箱验证。
   - error：boolean型响应式变量，用于判断是否发生错误。
   - errorMsg：响应式变量，用于存储错误信息。
   - submitBtnStyle：响应式变量，用于存储提交按钮的样式，主要用于控制按钮的禁用状态。

2. 方法：
   **实例方法**
   - changeAuthType方法：用于切换authType的值，影响表单的显示和验证规则。
   - submit方法：用于提交表单数据，根据authType的不同，检查不同的参数的合理性、调用不同的API进行登录、注册或重置密码、并处理返回结果。
   - checkValidity方法：用于验证用户输入的值是否符合规则，根据AuthType不同，调用各个UserMetaData实例的checkValidity方法进行验证。
   - authenticate方法：用于验证用户身份，根据AuthType不同，调用不同的API进行验证。
   - checkResponse方法：用于检查API返回的结果是否成功，并处理错误信息。成功则根据AuthType不同，进行不同的后续操作，如登录成功后跳转到首页，注册成功后跳转到用户引导界面。

### User
封装了用户的基本信息和操作。单例类，用于存储当前登录用户的身份信息、基本信息和关注列表（用于检查用户是否关注某人）等。
1. 属性：
   **静态属性**
   - #singleton：单例实例，私有
   - msgTranslation：Map类型，用于将后端返回的信息转换为中文。
   - MAX_COOKIE_AGE和MIN_COOKIE_AGE：用于设置cookie的最大和最小过期时间。
  
   **实例属性**
   - #userId：用户的唯一标识符，私有
   - #token：用户的身份验证令牌，私有
   - userInfo：用户的基本信息，是UserInfo类实例，详见user模块的UserInfo类。
   - followingList和followerList：用户关注的其他用户列表和关注用户的列表。主要用于关注按钮的状态检查。

2. 方法：
    **静态方法**：主要用于身份验证。
    - static块：用于在应用创建时检查cookie中是否有用户信息，如果有则自动创建User实例。
    - getInstance：获取单例实例。
    - generateHash：用于将用户的密码进行哈希处理。
    - handleError：处理后端返回的错误信息，将其转换为中文提示，同时提示前端是错误还是成功。
    - login：用于登录用户，调用loginAPI进行登录，调用meAPI获取用户信息，获取成功后自动创建User实例。
    - register：用于注册用户，调用registerAPI进行注册，注册成功后自动调用loginAPI进行登录。
    - sendAuthCode：用于发送验证码到用户的邮箱或手机号，调用sendCodeAPI进行发送。
    - verifyAuthCode：用于验证用户的邮箱或手机号验证码，调用verifyCodeAPI进行验证。

    **实例方法**：主要用于用户信息的管理和操作。
    - constructor：构造函数，用于初始化用户信息和关注列表。
    - saveToCookie：将用户信息保存到cookie中，主要用于登陆后记住登录状态。
    - logout：用于登出用户，清除cookie中的用户信息和令牌。
    - resetPassword：用于重置用户密码，调用resetPasswordAPI进行重置。因为只有在登录后才能重置密码，所以是实例方法。
    - get userAuth：存取器，用于获取用户的身份验证信息。
    - followUser：用于关注其他用户，调用followAPI进行关注。
    - unfollowUser：用于取消关注其他用户，调用unfollowAPI进行取消关注。

3. Token：分为AuthToken和SessionToken。
   - AuthToken：用于身份验证，存储在cookie中，过期时间为60天。
   - SessionToken：用于会话验证，存储在sessionStorage中，过期时间为1小时。 
   - User实例中的token是SessionToken，过期时间为1小时，且一定会储存在sessionStorage中，而且会在过期前自动刷新。
   - 每次登录或注册成功后，假如选择“自动登录”，则会将AuthToken存储在cookie中，过期时间为60天。

4. 由于User实例的创建采取异步创建的方式，为了避免在用户信息加载完成之前就使用User实例导致误判用户没有登入，所以使用一个loading的bool量表明用户信息是否正在加载。该变量在User实例创建时会被设置为true，直到用户信息加载完成后才会设置为false，并且保证创建之后的User实例一定是正确的。为了让一些只有再登陆后才能使用的功能（如关注其他用户）在用户信息加载完成后才可用，User实例中设置了一个afterLoadCallback数组，可以向该数组中添加回调函数，这些函数会在用户信息加载完成后被调用。

### UserAuthAPI
封装了与用户身份验证服务的API接口与数据类型，主要用于获取用户的身份验证信息。

API接口包括：
1. registerAPI：用于注册用户，调用后端的注册接口。
2. loginAPI：用于登录用户，调用后端的登录接口。
3. refreshTokenAPI：用于刷新用户的身份验证令牌，调用后端的刷新令牌接口。
4. meAPI：用于获取当前用户的身份信息，调用后端的用户信息接口。
5. sendCodeAPI：用于发送验证码到用户的邮箱，调用后端的发送验证码接口。
6. verifyCodeAPI：用于验证用户的邮箱验证码，调用后端的验证验证码接口。

### Style
user模块的样式文件，主要是一些Tailwind CSS的样式类，用于登录、注册、重置密码等界面的样式设置。
