# 开发需求文档(C组 社交圈子模块)

## PART1. 项目概述

### 1. 模块概述及边界

**模块定位**：
本模块为多媒体社交论坛平台系统中的用户社交与兴趣圈子模块，是系统中核心的互动功能模块。该模块主要负责用户间的社交关系建立与维护、社交互动、私信交流、违规举报处理、兴趣圈子的管理与运营等功能。在整个平台中，该模块承担着构建用户社交网络、促进用户互动交流、建立兴趣社区的重要角色，是提升平台活跃度和用户黏性的关键组成部分。

**业务目标**：
本模块的业务价值在于通过丰富的社交互动功能和兴趣圈子系统，为用户提供良好的社交体验，促进内容生产和分享，提高用户参与度和停留时间。具体目标包括：提升用户间互动频次，增强用户对平台的依赖性，通过兴趣圈子聚合同好形成垂直社区，通过积分激励机制促进用户主动创作高质量内容。成功的衡量指标包括用户日活跃度、私信量、关注关系数量、圈子活跃度、用户内容生产量等。

**边界界定**：

1. 与用户注册模块的边界：本模块关注用户间的社交关系、社交互动、兴趣圈子管理，不涉及用户注册认证、内容审核算法、等功能。（该部分属于用户注册认证模块负责）
2. 与贴子模块的边界：本模块关注用户之间的互动关系，圈子内展示的帖子的创建、编辑和具体展示则需要帖子模块负责实现。（后期可能需要在圈子内复用帖子展示的相关方法？）

### 2. 页面设计与功能流程

本模块涉及的主要页面包括：用户主页、关注/粉丝列表页、私信消息页、通知中心页、举报页、圈子首页、圈子详情页、圈子管理页、活动任务页和积分排行页。这些页面构成了完整的社交互动和圈子管理体系，支持用户进行社交互动和兴趣交流。

#### 社交模块页面布局+组件交互说明

自己用 figma 画了一点，但是比较简陋，就用谭神在群里发的了，布局差不多，主要参考微博和 B 站

1. 私信页面

主要功能

- 展示所有私信会话列表，支持搜索用户或消息。
- 点击会话切换右侧聊天窗口，显示与该用户的聊天记录。
- 聊天窗口支持发送文本消息（可扩展图片、表情、文件等）。
- 未读消息高亮提示。
- 聊天窗口顶部可点击用户头像进入对方主页。

![1752808355524](image/页面组件交互说明/1752808355524.png)

主要布局

- 进入方式：点击侧边导航栏“私信”按钮
- 侧边导航栏：“私信”按钮位置显示高亮，并且显示未读的消息数量
- 除侧边导航栏之外，分为左右两列，左边为私信列表，展示所有私信消息；右边为和其他用户的对话框
- 左列

  - 顶部标题为“私信”
  - 顶部标题下方为搜索框，用于搜索特定的用户或消息
  - 私信列表（**列表组件**）
    - 包含了和所有用户的私信
    - 展示和每一个用户的私信（封装成**按钮组件**），包含的内容有：对方用户的头像和昵称，最新的私信内容和时间
    - 点击**按钮组件**会在右列展示和该用户的聊天记录
    - 对于未读消息会给出提示

- 右列

  - 右列为和用户的聊天框，形式类似微信
  - 顶部显示用户的头像和昵称（按钮组件），点击会进入对方用户主页页面
  - 中间显示双方的聊天记录，每一条聊天消息作为一个组件，包含用户头像、消息框和消息内容
  - 底部是输入框和发送按钮，可拓展图片、表情、文件等功能

- 私信和通知一样加个设置？

主要交互事件

- 点击私信列表：展示和用户的具体私信
- 私信（用户/消息）搜索框
- 私信文本输入框
- 聊天框中点击自己/用户头像 → 个人/用户主页

2. 举报页面/窗口

![1752808437290](image/页面组件交互说明/1752808437290.png)

主要功能

- 以模态框形式展示举报表单。
- 支持多种举报原因选择，可填写补充说明。
- 支持图片上传（可扩展）。
- 提交举报或取消操作。

主要布局

- 进入方式：在用户主页或帖子页面点击举报
- 举报原因
  - **多选框组件**：各种举报原因
  - 补充说明（**输入框组件）**：文字+图片
- 相对简单，不单列交互事件了

3. 通知页面

![1752808461135](image/页面组件交互说明/1752808461135.png)

主要功能

- 展示所有通知信息，分为“全部”“@我”“回复”“点赞”四类，支持快速筛选。
- 每条通知以组件形式展示，内容包括用户头像、昵称、通知类型、相关帖子等。
- 支持点击用户头像进入主页，点击帖子内容进入帖子页。
- 右侧栏提供社区搜索和圈子推送。
- 多人点赞时可查看所有点赞用户。

主要布局

- 进入方式：点击侧边导航栏“通知”按钮
- 侧边导航栏：“通知”按钮位置显示高亮，并且显示未读的通知数量
- 除侧边导航栏外，分为两列，左列是主体，展示各种通知信息，右列为搜索框+圈子推送
- 左列
  - 顶部导航栏
    - 标题为“通知”，右侧有设置**按钮组件**，点击后进入通知设置页面
    - 通知信息列表：包含“全部”“@我”“回复”“点赞”选项按钮，用户可以点击这些按钮快速获得自己需要的信息
  - 通知信息
    - 每一条通知信息都封装成一个组件，便于展示和调用
    - 点赞通知：用户头像+用户昵称+固定文本“赞了你的帖子”+帖子图片（如有）+ 帖子标题
    - 关注通知：用户头像+用户昵称+固定文本“关注了你”
    - 回复通知：用户头像+用户昵称+固定文本“回复了你的帖子”+帖子图片（如有）+ 帖子标题
    - @通知：用户头像+用户昵称+固定文本“在帖子”+ 帖子标题 +“回复了你的帖子”+ 帖子图片（如有）
    - 点击组件可以转到目标帖子
- 右列

  - 搜索框
  - 圈子推送

    - 推送若干圈子
    - 每一个圈子可以封装一个组件，包括的内容有：圈子标签，圈子名称，帖子数量等

主要交互事件

- 选择具体的通知类型（点赞/回复/@），方便查找特定信息
- 点击用户头像 → 用户主页页面
- 点击帖子内容 → 帖子主页页面
- 搜索框搜索社区
- 点击推送的社区 → 社区主页页面
- 对于多人点赞的帖子，点击人数，可以查看所有点赞过的人

4. 关注者/被关注者页面

话说好友列表和这个的区别是什么

![1752808998434](image/页面组件交互说明/1752808998434.png)

主要功能

- 展示当前用户的关注者和正在关注列表。
- 每个用户以卡片组件展示，包含头像、昵称、简介、关注状态。
- 支持点击头像/昵称进入用户主页，点击关注/正在关注按钮切换关注状态。
- 右侧栏推荐可能感兴趣的用户。
- 支持搜索用户。

主要布局

- 进入方式：点击个人主页页面的“关注者”或“被关注者”按钮
- 侧边导航栏：“个人主页”按钮位置显示高亮
- 除侧边导航栏外，分为两列，左列是主体，展示关注者和被关注者信息，右列为搜索框+圈子推送
- 左列

  - 顶部导航栏
    - 标题为“用户名”，左侧有返回**按钮组件**，点击后回到个人主页
    - 关注者/被关注者列表：包含“关注者”“被关注者”选项按钮，用户可以点击这些按钮获得关注者/被关注者列表
  - 关注者/被关注者
    - 每一位关注者/被关注者信息都封装成一个组件，便于展示和调用
    - 组件信息：用户头像、昵称、简介，对该用户的关注状态（关注/正在关注）
    - 点击组件可以转到对方的个人主页
    - 点击关注/正在关注可以修改对该用户的关注状态

- 右列

  - 搜索框
  - 用户推送
    - 推送若干用户
    - 每一个用户可以封装一个组件，包括的内容有：用户头像、昵称、简介，对该用户的关注状态（关注/正在关注）

主要交互事件

- 选择“关注者”“被关注者”，方便查找特定信息
- 点击用户头像 → 用户主页页面
- 点击关注/正在关注，修改关注状态
- 搜索框搜索用户
- 点击推送的用户 → 用户主页页面

之前在 figma 上面画的

![1752809087935](image/页面组件交互说明/1752809087935.png)

#### 圈子模块主要页面及跳转流程：

首页点击社区

社区
页面说明：
社区主页面，用户可以在此浏览推荐的社区、创建新的社区以及查看热门趋势等内容。
页面分为三个主要部分：
· 左侧导航栏：提供全局导航，包括社区、关注、个人主页等功能。
· 中间内容区：展示推荐的社区列表（会显示是否加入，也提供加入选择）和用户加入的社区（包括自己加入的别人创建的社区与自己创建的社区汇总，点进去后会分区，上半部分显示自己创建的社区（若无则不显示），下半部分显示自己加入的社区（及社区简介））。
· 右侧辅助区：显示创建新社区的入口和热门趋势信息。

主要功能说明：

1. 推荐社区，显示系统推荐的社区，帮助用户快速找到感兴趣的主题。点击社区的名字，跳转至该社区详情页面。
2. 我的社区，列出当前用户已加入的社区，用于帮助用户快速访问已加入的社区，同时也可以点击对应社区后，跳转至该社区的详情页面。
   创建新社区，为用户提供创建新社区的入口。点击“创建社区”按钮，跳转至创建新社区页面。
3. 热门趋势，展示当前社区的热门话题与趋势，用户可以查看并参与热门讨论（可发帖 浏览等）。点击具体趋势时，可能跳转至相关的社区或帖子。

在社区点击创建新社区后

创建新社区页面
页面说明：
此页面是用户创建新社区的入口，包含以下功能和输入信息：
· 社区名称：填写新社区的名称。
· 社区简介：简单描述社区的主题和内容。
· 社区图标与封面：上传社区的标志性图片和封面图，加强视觉辨识度。
· 社区规模：选择社区的开放性（是否公开、人数限制等）。

主要功能说明：
社区名称输入框，用户填写后，该名称将显示在社区列表和详情中。
社区简介输入框，帮助其他用户了解社区的特色。
社区图标与封面上传，增强社区的视觉影响力。
创建按钮，点击该按钮后，生成一个新社区，并跳转至新创建的社区详情页面。

从社区点击某个社区或创建好点击生成新社区的按钮后跳转至社区详情页面

社区详情页面
页面展示社区的基本信息、帖子列表以及参与用户的信息。
页面分为以下部分：
· 社区基本信息区：展示社区名称、简介、图标及创建时间等信息。
· 帖子区域：列出社区内所有帖子，用户可以查看帖子详情、参与讨论。
· 右侧用户区：列出社区管理员和活跃用户。
主要功能说明：
创建帖子按钮，允许用户在社区内发布新内容，点击后跳转至“创建帖子”页面。
帖子列表，展示社区内的所有帖子。用户可以浏览和参与讨论，点击帖子后跳转至帖子详情页面。
社区成员，列出当前社区的管理员和活跃用户。管理员在前（有管理员标志），普通用户在后。用户可以查看社区的核心成员，并与他们互动。

## PART2. 开发中的技术细节说明

### 3. 前端组件结构与交互说明

还在 vue 入门阶段，组件列表暂时不好定下来，样式需要集中讨论确定。（？？？）

### 4. 后端接口设计

**（暂时能想到的，根据后续情况可能有改动，需及时沟通）**
本模块后端接口采用 RESTful 风格设计，涵盖用户社交互动与兴趣圈子管理的核心业务功能。接口设计注重安全性、一致性和可扩展性，为前端提供完整的数据交互能力。

#### 接口概览

| 业务功能                    | 方法   | 路径                                                     | 说明                         |
| --------------------------- | ------ | -------------------------------------------------------- | ---------------------------- |
| 关注用户                    | POST   | /api/user/follow/{userId}                                | 关注指定用户                 |
| 取消关注                    | DELETE | /api/user/follow/{userId}                                | 取消关注指定用户             |
| 获取关注列表                | GET    | /api/user/{userId}/following                             | 当前用户关注的人             |
| 获取粉丝列表                | GET    | /api/user/{userId}/followers                             | 关注当前用户的人             |
| 获取互关列表                | GET    | /api/user/{userId}/friends                               | 获取与当前用户互相关注的列表 |
| 提交举报                    | POST   | /api/report                                              | 提交违规内容举报             |
| 查询举报记录（后台）        | GET    | /api/report                                              | 管理员查询举报记录           |
| 处理举报（后台）            | PUT    | /api/report/{reportId}                                   | 管理员处理举报               |
| 获取私信会话列表            | GET    | /api/messages                                            | 获取会话列表                 |
| 获取聊天记录                | GET    | /api/messages/{userId}                                   | 拉取与指定用户的聊天记录     |
| 发送私信                    | POST   | /api/messages/{userId}                                   | 发送私信                     |
| 标记会话已读                | PUT    | /api/messages/{userId}/read                              | 将与指定用户的消息标为已读   |
| 获取通知列表                | GET    | /api/notifications                                       | 获取通知列表                 |
| 获取未读通知数量            | GET    | /api/notifications/unread-count                          | 获取未读通知数量             |
| 标记单条通知已读            | PUT    | /api/notifications/{notificationId}/read                 | 标记指定通知已读             |
| 标记全部通知已读            | PUT    | /api/notifications/read-all                              | 一键已读                     |
| 获取圈子列表/搜索圈子       | GET    | /api/circles                                             | 支持关键词查询、分页         |
| 创建圈子                    | POST   | /api/circles                                             | 新建兴趣圈子                 |
| 获取圈子详情                | GET    | /api/circles/{circleId}                                  | 圈子详情                     |
| 编辑圈子信息                | PUT    | /api/circles/{circleId}                                  | 修改圈子信息                 |
| 删除圈子                    | DELETE | /api/circles/{circleId}                                  | 圈主删除圈子                 |
| 申请加入圈子                | POST   | /api/circles/{circleId}/join                             | 申请加入                     |
| 查询加入申请列表（圈主）    | GET    | /api/circles/{circleId}/applications                     | 圈主查看待审批列表           |
| 审批加入申请                | PUT    | /api/circles/{circleId}/applications/{userId}            | 通过/拒绝加入申请            |
| 退出/踢出圈子成员           | DELETE | /api/circles/{circleId}/members/{userId}                 | 退出或移除成员               |
| 获取圈子成员列表            | GET    | /api/circles/{circleId}/members                          | 查看成员列表                 |
| 设置/取消圈子管理员         | POST   | /api/circles/{circleId}/admins/{userId}                  | 设为管理员                   |
| 取消圈子管理员              | DELETE | /api/circles/{circleId}/admins/{userId}                  | 移除管理员                   |
| 获取圈子帖子                | GET    | /api/circles/{circleId}/posts                            | 支持排序分页                 |
| 设置帖子精华                | POST   | /api/circles/{circleId}/posts/{postId}/highlight         | 设为精华                     |
| 取消帖子精华                | DELETE | /api/circles/{circleId}/posts/{postId}/highlight         | 取消精华                     |
| 置顶帖子                    | POST   | /api/circles/{circleId}/posts/{postId}/pin               | 置顶帖子                     |
| 取消置顶                    | DELETE | /api/circles/{circleId}/posts/{postId}/pin               | 取消置顶                     |
| 创建活动                    | POST   | /api/circles/{circleId}/activities                       | 创建圈子活动                 |
| 获取活动列表                | GET    | /api/circles/{circleId}/activities                       | 活动列表                     |
| 获取活动详情                | GET    | /api/activities/{activityId}                             | 查看活动详情                 |
| 参与活动                    | POST   | /api/circles/{circleId}/activities/{activityId}/join     | 参与活动                     |
| 完成活动任务                | PUT    | /api/circles/{circleId}/activities/{activityId}/complete | 标记任务完成                 |
| 获取圈子积分排行            | GET    | /api/circles/{circleId}/leaderboard                      | 查看积分榜                   |
| 获取个人在圈子积分详情      | GET    | /api/circles/{circleId}/points                           | 查看当前用户积分及记录       |
| 查询操作日志（圈主/管理员） | GET    | /api/circles/{circleId}/logs                             | 圈子操作日志                 |

#### 请求头与认证

所有接口均需在请求头中携带以下信息：

- `Authorization: Bearer <token>` - 用户身份认证令牌，通过登录接口获取，必填
- `Content-Type: application/json` - 请求体格式，POST/PUT 请求必填
- `Accept-Language: zh-CN` - 响应语言，可选，默认 zh-CN

认证说明：

- JWT 格式令牌，包含用户 ID、角色信息和过期时间
- 令牌有效期为 2 小时，过期需重新登录获取
- 令牌无效或过期时接口返回 401 状态码

#### 请求参数说明

以部分典型接口为例说明参数结构：

1. **关注用户**

| 字段名 | 数据类型 | 参数位置 | 含义          | 是否必填 |
| ------ | -------- | -------- | ------------- | -------- |
| userId | int      | URL Path | 被关注用户 ID | 是       |

2. **提交举报**

| 字段名      | 数据类型 | 参数位置     | 含义                              | 是否必填 |
| ----------- | -------- | ------------ | --------------------------------- | -------- |
| targetType  | string   | Request Body | 举报对象类型（post/comment/user） | 是       |
| targetId    | int      | Request Body | 被举报对象 ID                     | 是       |
| reason      | string   | Request Body | 举报理由                          | 是       |
| description | string   | Request Body | 补充说明                          | 否       |
| evidence    | string[] | Request Body | 证据图片 URL 数组                 | 否       |

3. **发送私信**

| 字段名   | 数据类型 | 参数位置     | 含义         | 是否必填 |
| -------- | -------- | ------------ | ------------ | -------- |
| userId   | int      | URL Path     | 接收用户 ID  | 是       |
| content  | string   | Request Body | 消息内容     | 是       |
| mediaUrl | string   | Request Body | 媒体文件 URL | 否       |

4. **获取圈子内容**

| 字段名    | 数据类型 | 参数位置 | 含义                       | 是否必填 |
| --------- | -------- | -------- | -------------------------- | -------- |
| circleId  | int      | URL Path | 圈子 ID                    | 是       |
| pageNum   | int      | Query    | 页码，默认 1               | 否       |
| pageSize  | int      | Query    | 每页条数，默认 20          | 否       |
| sortBy    | string   | Query    | 排序方式(new/hot/featured) | 否       |
| filterTag | string   | Query    | 按标签筛选                 | 否       |

5. **创建活动**

| 字段名      | 数据类型 | 参数位置     | 含义         | 是否必填 |
| ----------- | -------- | ------------ | ------------ | -------- |
| circleId    | int      | URL Path     | 圈子 ID      | 是       |
| title       | string   | Request Body | 活动标题     | 是       |
| description | string   | Request Body | 活动描述     | 是       |
| startTime   | datetime | Request Body | 开始时间     | 是       |
| endTime     | datetime | Request Body | 结束时间     | 是       |
| type        | string   | Request Body | 活动类型     | 是       |
| reward      | string   | Request Body | 奖励说明     | 是       |
| rules       | string   | Request Body | 活动规则     | 是       |
| cover       | string   | Request Body | 封面图片 URL | 否       |

#### 响应结构说明

所有接口统一采用 JSON 格式返回数据，基本结构如下：

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    // 实际业务数据
  }
}
```

各字段说明：

- `code`：状态码，200 表示成功，其他表示错误
- `msg`：提示信息，成功或错误的文字说明
- `data`：业务数据，结构根据接口不同而变化

以下是几个典型接口的响应示例：

**获取关注列表响应示例**：

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "total": 125,
    "pageNum": 1,
    "pageSize": 20,
    "list": [
      {
        "userId": 10001,
        "nickname": "用户昵称",
        "avatar": "https://example.com/avatar/10001.jpg",
        "followTime": "2023-06-15T08:30:25",
        "bio": "个人简介",
        "isFollowedBack": true
      }
      // 更多用户...
    ]
  }
}
```

**获取圈子详情响应示例**：

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "circleId": 5001,
    "name": "摄影爱好者",
    "description": "圈子描述信息",
    "owner": {
      "userId": 10086,
      "nickname": "圈主昵称"
    },
    "memberCount": 1580,
    "postCount": 3250,
    "tags": ["摄影", "风光", "人像"],
    "joinType": "review",
    "created": "2023-01-15T10:20:30",
    "cover": "https://example.com/circle/5001/cover.jpg",
    "currentUserRole": "member",
    "activityCount": 12
  }
}
```

**提交举报响应示例**：

```json
{
  "code": 200,
  "msg": "举报提交成功",
  "data": {
    "reportId": 8001,
    "createTime": "2023-06-20T15:30:45"
  }
}
```

#### 错误码与异常

**（暂定，后续可根据情况改动，需及时沟通）**
接口错误码体系采用 HTTP 状态码结合业务码的方式，主要包括：

**HTTP 状态码**：

- `200 OK` - 请求成功
- `400 Bad Request` - 请求参数错误
- `401 Unauthorized` - 未授权或授权失败
- `403 Forbidden` - 权限不足
- `404 Not Found` - 资源不存在
- `409 Conflict` - 资源冲突或重复操作
- `429 Too Many Requests` - 请求频率超限
- `500 Internal Server Error` - 服务器内部错误

**业务错误码**：

- `1001~1999` - 用户相关错误

  - `1001` - 用户不存在
  - `1002` - 已关注该用户
  - `1003` - 未关注该用户
  - `1004` - 用户已被封禁
  - `1005` - 被用户拉黑，无法关注

- `2001~2999` - 社交互动相关错误

  - `2001` - 重复举报
  - `2002` - 举报对象不存在
  - `2003` - 私信发送频率超限
  - `2004` - 接收方设置了陌生人私信限制

- `3001~3999` - 圈子相关错误
  - `3001` - 圈子不存在
  - `3002` - 重复申请加入圈子
  - `3003` - 无权操作该圈子
  - `3004` - 活动已结束
  - `3005` - 已达到圈子成员上限

错误响应示例：

```json
{
  "code": 400,
  "msg": "请求参数错误",
  "errorCode": 1001,
  "description": "用户不存在"
}
```

异常处理原则：

- 客户端参数错误返回 400，并明确指出错误字段
- 身份认证失败返回 401，并提示重新登录
- 权限不足返回 403，并说明所需权限
- 资源不存在返回 404，并说明资源类型
- 服务器错误返回 500，记录详细日志但不向客户端暴露内部错误细节

#### 接口联调备注

接口联调流程采用三阶段递进方式：

1. **接口定义阶段**：

   - 测试环境地址：https://test-api.socialforum.com
   - 使用 Swagger UI 自动生成接口文档：https://test-api.socialforum.com/swagger
   - 前后端共同评审接口定义，确认数据结构和业务逻辑

2. **接口开发联调**：

   - 后端开发完成单个接口后即通知前端进行联调
   - 联调中发现的问题记录在 Jira 上，标记优先级跟踪解决
   - 每周二、四上午 10:00 进行联调例会，同步进度和解决问题

3. **集成测试阶段**：
   - 测试账号准备：各角色（普通用户、圈主、管理员）各 3 个账号
   - 编写端到端测试用例，覆盖核心业务流程
   - 使用 Postman 集成测试，测试集加入 CI/CD 流程

Mock 数据策略：

- 前端开发阶段使用 Mock.js 模拟接口返回数据
- Mock 数据按照接口文档定义的结构生成，覆盖正常和异常场景
- 建立 Mock 数据与 Swagger 定义的自动同步机制，确保一致性
- Mock 接口可通过环境变量切换，便于前端独立开发和联调

详细的 Mock 数据方案参见第 11 节"接口联调与 Mock 策略"。

### 5. 数据库设计

**（详见群内已经确定过的 表设计 文件）**

本模块涉及的主要数据表包括用户关注表（Follow）、举报表（Report）、私信表（Message）、通知表（未在 tables.md 中列出，需新增）、圈子表（Circle）、圈子成员表（CircleMember）、活动表（Activity）以及用户参与活动记录表（需新增）。以下是对这些表的详细说明：

通知表（Notification）可能需要新增，用于存储各类系统通知和用户互动提醒，包括如下字段：

- notification_id（INT PK）：通知 ID
- user_id（INT FK）：接收通知的用户 ID
- notification_type（ENUM）：通知类型（如评论提醒、点赞提醒、关注提醒、系统公告等）
- related_id（INT）：关联对象 ID（如帖子 ID、评论 ID）
- content（TEXT）：通知内容
- sender_id（INT FK）：触发通知的用户 ID
- created_at（DATETIME）：通知创建时间
- is_read（BOOLEAN）：阅读状态

用户参与活动记录表（ActivityParticipant）可能需要新增，用于记录用户参与活动的情况：

- activity_id（INT FK）：活动 ID
- user_id（INT FK）：用户 ID
- join_time（DATETIME）：参与时间
- status（ENUM）：参与状态（进行中/已完成）
- reward_status（ENUM）：奖励状态（未领取/已领取）

数据表之间的关系主要表现为：用户表（User）是核心实体，与关注表、举报表、私信表、通知表、圈子成员表都存在关联；圈子表关联圈子成员表和活动表；活动表关联用户参与活动记录表。主要的外键关系有：关注表中 follower_id 和 followee_id 关联用户表 user_id；举报表中 reporter_id 关联用户表 user_id；私信表中 sender_id 和 receiver_id 关联用户表 user_id；圈子成员表中 user_id 关联用户表 user_id，circle_id 关联圈子表 circle_id 等。

### 6. 权限与用户角色控制

本模块的权限管理基于角色的访问控制（RBAC）模型，主要定义了以下角色：普通用户、圈主、圈子管理员和平台管理员。各角色权限范围如下：

普通用户可以进行基本的社交互动，如关注/取关其他用户、发送私信（除非被对方拉黑）、查看和加入公开圈子、参与圈子活动、查看通知等。普通用户对自己发布的内容有修改和删除权限，但无法管理他人内容。

圈主是创建圈子的用户，拥有圈子的最高管理权限，可以修改圈子信息、设置圈子规则、任命和撤销圈子管理员、审核加入申请、设置内容置顶和加精、发起圈子活动、管理违规内容和用户等。圈主还可以转让圈主身份给其他活跃成员。

圈子管理员由圈主任命，协助圈主管理圈子，权限包括审核加入申请、管理日常内容（设置精华、删除违规）、协助管理活动等，但不能修改圈子基本信息或管理其他管理员。

平台管理员是系统级角色，可以管理所有圈子和用户，处理举报投诉，监控违规内容，必要时可干预圈子运营或封禁违规账号。平台管理员的操作权限覆盖所有功能模块。

前端权限控制主要通过路由守卫和条件渲染实现。用户登录后，系统获取其角色信息并存储在全局状态中，路由守卫检查用户是否有权访问特定页面，组件内部则根据用户角色动态显示或隐藏特定操作按钮。例如，只有圈主和管理员才能看到内容管理按钮，只有圈主才能看到管理员设置选项。

后端权限校验基于 JWT 令牌和中间件实现，接口调用时验证用户身份和权限。例如，圈子管理接口需要验证用户是否为该圈子的圈主或管理员，举报处理接口需要验证是否为平台管理员。权限不足时返回 403 状态码和相应错误信息。

### 7. 第三方依赖与集成点说明

本模块可能使用到以下外部服务：

1. 文件存储：使用阿里云 OSS 保存用户上传的图片、视频等文件。
2. 搜索服务：通过 Elasticsearch 提供圈子和用户的关键词搜索能力。

接入方式很简单：服务端通过官方 SDK 或 REST API 调用对应服务，所有密钥放在环境变量里，超时和重试策略按默认配置即可。如需修改，只要在配置中心调整即可，代码里不写死任何密钥。

## PART3. 开发策略与约定

### 8. 状态管理方案

前端使用 Vuex 存放全局数据。我们把数据分成四块：

1. user：当前用户信息和角色。
2. social：关注、粉丝等社交关系。
3. message：私信和通知。
4. circle：圈子及活动信息。

组件通过 `mapState` 读数据，通过 `dispatch` 触发 action 请求后端，再用 mutation 把结果写回 store。这样所有界面都能自动刷新，不用手动同步。

### 9. 输入校验与异常处理

- 前端：用 Vuelidate 做必填、长度、格式检查，尽早阻止非法输入。
- 后端：再用注解校验一次，防止绕过前端。
- 出错时统一返回 `{code, msg}`，前端按 code 决定提示内容，例如 400 参数错、401 登录失效、403 没权限、500 服务器异常。
- 常见边界情况：并发操作冲突、网络中断、恶意攻击等，都有对应的错误码和友好提示。

### 10. 开发约定

- 代码规范：前端遵循 Vue 官方风格，后端遵循 RESTful 和 C# 编码规范。
- 环境：前端 Node 16+、Vue 3+；后端 .NET 8.0+。

### 11. 接口联调与 Mock

后端写完接口 → Swagger 自动生成文档 → 前端测试。
