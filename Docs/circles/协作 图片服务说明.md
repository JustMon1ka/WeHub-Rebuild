# CircleService 图片上传功能使用文档

## 功能概述

CircleService 已实现圈子头像和背景图上传功能，支持用户自定义圈子外观。图片文件存储在资源服务器（120.26.118.70:5001），数据库保存图片 URL。

### 配置检查

确保 `appsettings.Development.json` 中的配置正确：

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Data Source=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=121.41.78.106)(PORT=1521))(CONNECT_DATA=(SERVICE_NAME=ORCLPDB1)));User Id=weibo_dev;Password=HelloOracle;"
  },
  "FileBrowser": {
    "BaseUrl": "http://120.26.118.70:5001"
  }
}
```

## API 接口文档

### 1. 上传圈子头像

**接口地址：** `POST /api/circles/{circleId}/avatar`

**请求参数：**

- `circleId` (路径参数): 圈子 ID
- `file` (表单文件): 图片文件

**支持格式：** JPG、PNG、GIF
**文件大小限制：** 5MB

**请求示例：**

```bash
curl -X POST "http://localhost:5000/api/circles/1/avatar" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@avatar.jpg"
```

**响应示例：**

```json
{
  "success": true,
  "message": "头像上传成功",
  "data": {
    "imageUrl": "http://120.26.118.70:5001/api/resources/circles/1/avatar_20250827120000_abc123.jpg",
    "fileName": "avatar.jpg",
    "fileSize": 102400,
    "contentType": "image/jpeg"
  }
}
```

### 2. 上传圈子背景图

**接口地址：** `POST /api/circles/{circleId}/banner`

**请求参数：**

- `circleId` (路径参数): 圈子 ID
- `file` (表单文件): 图片文件

**支持格式：** JPG、PNG、GIF
**文件大小限制：** 10MB

**请求示例：**

```bash
curl -X POST "http://localhost:5000/api/circles/1/banner" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@banner.jpg"
```

**响应示例：**

```json
{
  "success": true,
  "message": "背景图上传成功",
  "data": {
    "imageUrl": "http://120.26.118.70:5001/api/resources/circles/1/banner_20250827120000_def456.jpg",
    "fileName": "banner.jpg",
    "fileSize": 204800,
    "contentType": "image/jpeg"
  }
}
```

### GET /api/Test/filebrowser

用于测试与文件服务器的连接状态，放着就行，前端估计用不到
