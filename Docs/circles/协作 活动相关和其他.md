# CircleService æ´»åŠ¨ç›¸å…³æ¥å£è¯´æ˜ åŠ æˆªè‡³ 9.6 çš„ä¸€äº›å…¶ä»–æ”¹åŠ¨

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

CircleService æä¾›äº†å®Œæ•´çš„åœˆå­æ´»åŠ¨ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ´»åŠ¨çš„åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ï¼Œä»¥åŠç”¨æˆ·å‚ä¸æ´»åŠ¨çš„å®Œæ•´æµç¨‹ã€‚æ´»åŠ¨ç³»ç»Ÿæ”¯æŒå¥–åŠ±æœºåˆ¶å’Œå‚ä¸çŠ¶æ€è·Ÿè¸ªã€‚

## ğŸ—„ï¸ æ•°æ®åº“è¡¨ç»“æ„

### ACTIVITIES è¡¨ï¼ˆæ´»åŠ¨è¡¨ï¼‰

- **ACTIVITY_ID**: æ´»åŠ¨ IDï¼ˆä¸»é”®ï¼‰
- **CIRCLE_ID**: æ‰€å±åœˆå­ ID
- **TITLE**: æ´»åŠ¨æ ‡é¢˜ï¼ˆæœ€å¤§ 200 å­—ç¬¦ï¼‰
- **DESCRIPTION**: æ´»åŠ¨è¯¦ç»†æè¿°
- **REWARD_DESCRIPTION**: æ´»åŠ¨å¥–åŠ±æè¿°
- **REWARD_POINTS**: æ´»åŠ¨å¥–åŠ±ç‚¹æ•°
- **ACTIVITY_TYPE**: æ´»åŠ¨ç±»å‹ï¼ˆ0=æ‰‹åŠ¨å®Œæˆ, 1=å‘å¸–æ´»åŠ¨, 2=ç­¾åˆ°æ´»åŠ¨, 3=ç‚¹èµæ´»åŠ¨ï¼‰
- **START_TIME**: æ´»åŠ¨å¼€å§‹æ—¶é—´
- **END_TIME**: æ´»åŠ¨ç»“æŸæ—¶é—´
- **ACTIVITY_URL**: æ´»åŠ¨å°é¢å›¾ç‰‡çš„ URLï¼Œï¼ˆä¸åœˆå­å¤´åƒèƒŒæ™¯ç­‰å›¾ç‰‡ä½¿ç”¨æ–¹æ³•åŒç†ï¼Œè°ƒç”¨åæ¥çš„æ–°æ·»åŠ æ¥å£æ¸²æŸ“ï¼‰

### ACTIVITY_PARTICIPANTS è¡¨ï¼ˆæ´»åŠ¨å‚ä¸è€…è¡¨ï¼‰

- **ACTIVITY_ID**: æ´»åŠ¨ IDï¼ˆå¤åˆä¸»é”®ï¼‰
- **USER_ID**: ç”¨æˆ· IDï¼ˆå¤åˆä¸»é”®ï¼‰
- **JOIN_TIME**: åŠ å…¥æ´»åŠ¨æ—¶é—´
- **STATUS**: å‚ä¸çŠ¶æ€ï¼ˆ1 InProgress=è¿›è¡Œä¸­, 0 Completed=å·²å®Œæˆï¼‰
- **REWARD_STATUS**: å¥–åŠ±çŠ¶æ€ï¼ˆ0 NotClaimed=æœªé¢†å–, 1 Claimed=å·²é¢†å–ï¼‰

## ğŸš€ API æ¥å£åˆ—è¡¨

### 1. æ´»åŠ¨ç®¡ç†æ¥å£

#### 1.1 è·å–åœˆå­çš„æ‰€æœ‰æ´»åŠ¨

**æ¥å£åœ°å€ï¼š** `GET /api/circles/{circleId}/activities`

**åŠŸèƒ½ï¼š** è·å–æŒ‡å®šåœˆå­å†…çš„æ‰€æœ‰æ´»åŠ¨åˆ—è¡¨

**è¯·æ±‚å‚æ•°ï¼š**

- `circleId` (è·¯å¾„å‚æ•°): åœˆå­ ID

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "message": "è·å–æ´»åŠ¨åˆ—è¡¨æˆåŠŸ",
  "data": [
    {
      "activityId": 1,
      "circleId": 81,
      "title": "æ¯æ—¥ç­¾åˆ°æ´»åŠ¨",
      "description": "æ¯å¤©ç­¾åˆ°å¯è·å¾—ç§¯åˆ†å¥–åŠ±",
      "reward": "æ¯æ—¥10ç§¯åˆ†",
      "startTime": "2025-01-01T00:00:00Z",
      "endTime": "2025-12-31T23:59:59Z"
    }
  ]
}
```

#### 1.2 åˆ›å»ºæ–°æ´»åŠ¨(æ³¨æ„ï¼ï¼æµ‹è¯•åˆ›å»ºå’Œæ›´æ–°æ´»åŠ¨æ—¶ï¼Œè¦æ³¨æ„ç¼–è¾‘æ´»åŠ¨ç»“æŸæ—¶é—´è¿œä¸€äº›ï¼Œç»“æŸæ—¶é—´å¦‚æœä¸å¼€å§‹æ—¶é—´ç›¸åŒæˆ–ç¦»å¾—å¤ªè¿‘ï¼Œå›å¤´è°ƒç”¨åŠ å…¥æ´»åŠ¨æ¥å£æ—¶æ´»åŠ¨ä¼šè¿‡æœŸï¼)

**æ¥å£åœ°å€ï¼š** `POST /api/circles/{circleId}/activities`

**åŠŸèƒ½ï¼š** åœ¨æŒ‡å®šåœˆå­ä¸­åˆ›å»ºæ–°æ´»åŠ¨

**è¯·æ±‚å‚æ•°ï¼š**

- `circleId` (è·¯å¾„å‚æ•°): åœˆå­ ID
- `createActivityDto` (è¯·æ±‚ä½“): æ´»åŠ¨åˆ›å»ºæ•°æ®

**è¯·æ±‚ä½“æ ¼å¼ï¼š**

```json
{
  "title": "æ¯æ—¥ç­¾åˆ°æ´»åŠ¨",
  "description": "æ¯å¤©ç­¾åˆ°å¯è·å¾—ç§¯åˆ†å¥–åŠ±",
  "rewardDescription": "æ¯æ—¥10ç§¯åˆ†",
  "rewardPoints": 10,
  "activityType": 2,
  "startTime": "2025-01-01T00:00:00Z",
  "endTime": "2025-12-31T23:59:59Z"
}
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "message": "æ´»åŠ¨åˆ›å»ºæˆåŠŸ",
  "data": {
    "activityId": 1,
    "circleId": 81,
    "title": "æ¯æ—¥ç­¾åˆ°æ´»åŠ¨",
    "description": "æ¯å¤©ç­¾åˆ°å¯è·å¾—ç§¯åˆ†å¥–åŠ±",
    "rewardDescription": "æ¯æ—¥10ç§¯åˆ†",
    "rewardPoints": 10,
    "activityType": 2,
    "startTime": "2025-01-01T00:00:00Z",
    "endTime": "2025-12-31T23:59:59Z"
  }
}
```

#### 1.3 æ›´æ–°æ´»åŠ¨

**æ¥å£åœ°å€ï¼š** `PUT /api/circles/{circleId}/activities/{activityId}`

**åŠŸèƒ½ï¼š** æ›´æ–°æŒ‡å®šæ´»åŠ¨çš„ä¿¡æ¯

**è¯·æ±‚å‚æ•°ï¼š**

- `circleId` (è·¯å¾„å‚æ•°): åœˆå­ ID
- `activityId` (è·¯å¾„å‚æ•°): æ´»åŠ¨ ID
- `updateActivityDto` (è¯·æ±‚ä½“): æ´»åŠ¨æ›´æ–°æ•°æ®

**è¯·æ±‚ä½“æ ¼å¼ï¼š** ä¸åˆ›å»ºæ´»åŠ¨ç›¸åŒ

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "message": "æ´»åŠ¨æ›´æ–°æˆåŠŸ",
  "data": null
}
```

#### 1.4 è·å–æ´»åŠ¨è¯¦æƒ…

**æ¥å£åœ°å€ï¼š** `GET /api/circles/{circleId}/activities/{activityId}`

**åŠŸèƒ½ï¼š** è·å–æŒ‡å®šæ´»åŠ¨çš„è¯¦ç»†ä¿¡æ¯

**è¯·æ±‚å‚æ•°ï¼š**

- `circleId` (è·¯å¾„å‚æ•°): åœˆå­ ID
- `activityId` (è·¯å¾„å‚æ•°): æ´»åŠ¨ ID

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "message": "è·å–æ´»åŠ¨è¯¦æƒ…æˆåŠŸ",
  "data": {
    "activityId": 1,
    "circleId": 81,
    "title": "æ¯æ—¥ç­¾åˆ°æ´»åŠ¨",
    "description": "æ¯å¤©ç­¾åˆ°å¯è·å¾—ç§¯åˆ†å¥–åŠ±",
    "rewardDescription": "æ¯æ—¥10ç§¯åˆ†",
    "rewardPoints": 10,
    "activityType": 2,
    "activityUrl": "http://120.26.118.70:5001/api/preview/big/uploads/activities/1/cover_20250101120000_abc123.png?inline=true&key=1756694908718",
    "startTime": "2025-01-01T00:00:00Z",
    "endTime": "2025-12-31T23:59:59Z"
  }
}
```

#### 1.5 åˆ é™¤æ´»åŠ¨

**æ¥å£åœ°å€ï¼š** `DELETE /api/circles/{circleId}/activities/{activityId}`

**åŠŸèƒ½ï¼š** åˆ é™¤æŒ‡å®šæ´»åŠ¨

**è¯·æ±‚å‚æ•°ï¼š**

- `circleId` (è·¯å¾„å‚æ•°): åœˆå­ ID
- `activityId` (è·¯å¾„å‚æ•°): æ´»åŠ¨ ID

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "message": "æ´»åŠ¨åˆ é™¤æˆåŠŸ",
  "data": null
}
```

#### 1.6 ä¸Šä¼ æ´»åŠ¨å°é¢å›¾ç‰‡

**æ¥å£åœ°å€ï¼š** `POST /api/circles/{circleId}/activities/{activityId}/cover`

**åŠŸèƒ½ï¼š** ä¸Šä¼ æ´»åŠ¨å°é¢å›¾ç‰‡ï¼Œä¸åœˆå­å¤´åƒèƒŒæ™¯å›¾ä½¿ç”¨æ–¹æ³•ç±»ä¼¼

**è¯·æ±‚å‚æ•°ï¼š**

- `circleId` (è·¯å¾„å‚æ•°): åœˆå­ ID
- `activityId` (è·¯å¾„å‚æ•°): æ´»åŠ¨ ID
- `file` (è¡¨å•æ–‡ä»¶): å›¾ç‰‡æ–‡ä»¶

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "message": "æ´»åŠ¨å°é¢å›¾ç‰‡ä¸Šä¼ æˆåŠŸ",
  "data": {
    "imageUrl": "http://120.26.118.70:5001/api/preview/big/uploads/activities/1/cover_20250101120000_abc123.png?inline=true&key=1756694908718",
    "fileName": "activity_cover.jpg",
    "fileSize": 1024000,
    "contentType": "image/jpeg"
  }
}
```

### 2. æ´»åŠ¨å‚ä¸æ¥å£

#### 2.1 æŠ¥åå‚åŠ æ´»åŠ¨

**æ¥å£åœ°å€ï¼š** `POST /api/activities/{activityId}/participants/join`

**åŠŸèƒ½ï¼š** ç”¨æˆ·æŠ¥åå‚åŠ æŒ‡å®šæ´»åŠ¨

**è¯·æ±‚å‚æ•°ï¼š**

- `activityId` (è·¯å¾„å‚æ•°): æ´»åŠ¨ ID

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "message": "æˆåŠŸå‚åŠ æ´»åŠ¨",
  "data": null
}
```

#### 2.2 æ‰‹åŠ¨ å®Œæˆæ´»åŠ¨ä»»åŠ¡

**æ¥å£åœ°å€ï¼š** `PUT /api/activities/{activityId}/participants/complete`

**åŠŸèƒ½ï¼š** ç”¨æˆ·æ ‡è®°æ´»åŠ¨ä»»åŠ¡ä¸ºå·²å®Œæˆ

**è¯·æ±‚å‚æ•°ï¼š**

- `activityId` (è·¯å¾„å‚æ•°): æ´»åŠ¨ ID

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "message": "æ´»åŠ¨ä»»åŠ¡å·²å®Œæˆ",
  "data": null
}
```

#### 2.3 é¢†å–æ´»åŠ¨å¥–åŠ±

**æ¥å£åœ°å€ï¼š** `POST /api/activities/{activityId}/participants/claim-reward`

**åŠŸèƒ½ï¼š** ç”¨æˆ·é¢†å–æ´»åŠ¨å¥–åŠ±

**è¯·æ±‚å‚æ•°ï¼š**

- `activityId` (è·¯å¾„å‚æ•°): æ´»åŠ¨ ID

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "message": "å¥–åŠ±é¢†å–æˆåŠŸ",
  "data": {
    "reward": "æ¯æ—¥10ç§¯åˆ†",
    "claimedAt": "2025-01-15T10:30:00Z"
  }
}
```

### 3. æ´»åŠ¨è‡ªåŠ¨å®Œæˆäº‹ä»¶æ¥å£(è¿™å‡ ä¸ªæ¥å£åº”è¯¥æ˜¯åœ¨ç”¨æˆ·å‘å¸–ã€ç‚¹èµç­‰è¡Œä¸ºåè°ƒç”¨ï¼Œå®ç°æ´»åŠ¨å®Œæˆçš„è‡ªåŠ¨åˆ¤æ–­ã€‚ä½†æ˜¯éœ€è¦ç­‰åˆ°é¡¹ç›®ä¸å…¶ä»–ç»„æ•´åˆååŠ å…¥ï¼Œæ¯”è¾ƒä¸å¥½å®ç°ã€‚ã€‚ã€‚å¦‚æœå®åœ¨éš¾å®ç°å¯ä»¥è€ƒè™‘èˆå¼ƒè¿™éƒ¨åˆ†ï¼Œæ´»åŠ¨å°±çº¯æ‰‹åŠ¨æ ‡è®°å®Œæˆç®—äº†ã€‚ã€‚ã€‚)

å¤§æ¦‚çš„ä½¿ç”¨æµç¨‹æ˜¯è¿™æ ·ï¼š
graph TD
A[ç”¨æˆ·å‘å¸–] --> B[å‰ç«¯è°ƒç”¨å‘å¸–äº‹ä»¶æ¥å£]
B --> C[åç«¯æŸ¥è¯¢å‘å¸–ç±»å‹æ´»åŠ¨]
C --> D{ç”¨æˆ·æ˜¯å¦å·²å‚ä¸?}
D -->|å¦| E[è‡ªåŠ¨åŠ å…¥æ´»åŠ¨å¹¶æ ‡è®°å®Œæˆ]
D -->|æ˜¯| F{æ´»åŠ¨çŠ¶æ€æ˜¯å¦ä¸ºè¿›è¡Œä¸­?}
F -->|æ˜¯| G[æ›´æ–°çŠ¶æ€ä¸ºå·²å®Œæˆ]
F -->|å¦| H[æ— éœ€æ“ä½œ]
E --> I[è¿”å›å®Œæˆçš„æ´»åŠ¨æ•°é‡]
G --> I
H --> I

#### 3.1 å¤„ç†ç”¨æˆ·å‘å¸–äº‹ä»¶

**æ¥å£åœ°å€ï¼š** `POST /api/activity-events/post-created`

**åŠŸèƒ½ï¼š** å½“ç”¨æˆ·å‘å¸–æ—¶ï¼Œè‡ªåŠ¨å®Œæˆç›¸å…³çš„å‘å¸–ç±»å‹æ´»åŠ¨

**è¯·æ±‚å‚æ•°ï¼š**

- `PostCreatedEventRequest` (è¯·æ±‚ä½“): å‘å¸–äº‹ä»¶æ•°æ®

**è¯·æ±‚ä½“æ ¼å¼ï¼š**

```json
{
  "userId": 123,
  "circleId": 81,
  "postId": 456
}
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "message": "å‘å¸–äº‹ä»¶å¤„ç†å®Œæˆï¼Œè‡ªåŠ¨å®Œæˆäº† 2 ä¸ªæ´»åŠ¨",
  "data": {
    "completedActivities": 2
  }
}
```

#### 3.2 å¤„ç†ç”¨æˆ·ç‚¹èµäº‹ä»¶

**æ¥å£åœ°å€ï¼š** `POST /api/activity-events/post-liked`

**åŠŸèƒ½ï¼š** å½“ç”¨æˆ·ç‚¹èµå¸–å­æ—¶ï¼Œè‡ªåŠ¨å®Œæˆç›¸å…³çš„ç‚¹èµç±»å‹æ´»åŠ¨

**è¯·æ±‚å‚æ•°ï¼š**

- `PostLikedEventRequest` (è¯·æ±‚ä½“): ç‚¹èµäº‹ä»¶æ•°æ®

**è¯·æ±‚ä½“æ ¼å¼ï¼š**

```json
{
  "userId": 123,
  "circleId": 81,
  "postId": 456
}
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "message": "ç‚¹èµäº‹ä»¶å¤„ç†å®Œæˆï¼Œè‡ªåŠ¨å®Œæˆäº† 1 ä¸ªæ´»åŠ¨",
  "data": {
    "completedActivities": 1
  }
}
```

#### 3.3 å¤„ç†ç”¨æˆ·ç­¾åˆ°äº‹ä»¶

**æ¥å£åœ°å€ï¼š** `POST /api/activity-events/check-in`

**åŠŸèƒ½ï¼š** å½“ç”¨æˆ·ç­¾åˆ°æ—¶ï¼Œè‡ªåŠ¨å®Œæˆç›¸å…³çš„ç­¾åˆ°ç±»å‹æ´»åŠ¨

**è¯·æ±‚å‚æ•°ï¼š**

- `CheckInEventRequest` (è¯·æ±‚ä½“): ç­¾åˆ°äº‹ä»¶æ•°æ®

**è¯·æ±‚ä½“æ ¼å¼ï¼š**

```json
{
  "userId": 123,
  "circleId": 81
}
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "message": "ç­¾åˆ°äº‹ä»¶å¤„ç†å®Œæˆï¼Œè‡ªåŠ¨å®Œæˆäº† 1 ä¸ªæ´»åŠ¨",
  "data": {
    "completedActivities": 1
  }
}
```

### 4. ç”¨æˆ·å¯¹æ´»åŠ¨å‚ä¸æƒ…å†µçš„æ¥å£

#### 4.1 è·å–ç”¨æˆ·å‚ä¸çš„æ‰€æœ‰æ´»åŠ¨è¯¦æƒ…

**æ¥å£åœ°å€ï¼š** `GET /api/activity-participants/user/{userId}/participations`

**åŠŸèƒ½ï¼š** è·å–æŒ‡å®šç”¨æˆ·å‚ä¸çš„æ‰€æœ‰æ´»åŠ¨çŠ¶æ€ä¿¡æ¯

**è¯·æ±‚å‚æ•°ï¼š**

- `userId` (è·¯å¾„å‚æ•°): ç”¨æˆ· ID

**æƒé™è¦æ±‚ï¼š** ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„å‚ä¸çŠ¶æ€

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "message": "è·å–ç”¨æˆ·æ´»åŠ¨å‚ä¸çŠ¶æ€æˆåŠŸ",
  "data": [
    {
      "activityId": 1,
      "circleId": 1,
      "activityTitle": "æ¯æ—¥ç­¾åˆ°æ´»åŠ¨",
      "userId": 2,
      "status": 1,
      "rewardStatus": 0,
      "joinTime": "2025-01-01T10:00:00Z",
      "rewardPoints": 100,
      "activityType": 2,
      "startTime": "2025-01-01T00:00:00Z",
      "endTime": "2025-01-31T23:59:59Z"
    }
  ]
}
```

#### 4.2 æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å‚ä¸äº†æŒ‡å®šæ´»åŠ¨

**æ¥å£åœ°å€ï¼š** `GET /api/activity-participants/activity/{activityId}/user/{userId}`

**åŠŸèƒ½ï¼š** æ£€æŸ¥æŒ‡å®šç”¨æˆ·æ˜¯å¦å‚ä¸äº†æŸä¸ªæ´»åŠ¨ï¼Œå¹¶è¿”å›å‚ä¸çŠ¶æ€

**è¯·æ±‚å‚æ•°ï¼š**

- `activityId` (è·¯å¾„å‚æ•°): æ´»åŠ¨ ID
- `userId` (è·¯å¾„å‚æ•°): ç”¨æˆ· ID

**æƒé™è¦æ±‚ï¼š** ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„å‚ä¸çŠ¶æ€

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "message": "è·å–ç”¨æˆ·æ´»åŠ¨å‚ä¸çŠ¶æ€æˆåŠŸ",
  "data": {
    "activityId": 1,
    "circleId": 1,
    "activityTitle": "æ¯æ—¥ç­¾åˆ°æ´»åŠ¨",
    "userId": 2,
    "status": 1,
    "rewardStatus": 0,
    "joinTime": "2025-01-01T10:00:00Z",
    "rewardPoints": 100,
    "activityType": 2,
    "startTime": "2025-01-01T00:00:00Z",
    "endTime": "2025-01-31T23:59:59Z"
  }
}
```

**å¦‚æœç”¨æˆ·æœªå‚ä¸è¯¥æ´»åŠ¨ï¼š**

```json
{
  "success": true,
  "message": "ç”¨æˆ·æœªå‚ä¸è¯¥æ´»åŠ¨",
  "data": null
}
```
