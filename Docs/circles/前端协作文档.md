# CircleService 后端接口协作文档

这份文档将指导你如何在本地运行 `CircleService` 后端服务，并与前端页面进行对接。

## 1. 环境准备

在开始之前，请确保你的电脑上已经安装了以下软件。这些是运行 .NET Core 项目所必需的。

- **[.NET 8.0 SDK](https://dotnet.microsoft.com/download/dotnet/8.0)**: 这是我们项目使用的软件开发工具包。请务必安装 SDK 版本，而不是仅安装 Runtime。
- **[Git](https://git-scm.com/downloads/)**: 用于代码版本控制和团队协作。
- **一个代码编辑器**: 推荐使用 [Visual Studio 2022]（可以在 vscode 或其他编译器内写项目 vs2022 内运行）。

---

## 2. 运行后端服务，查看接口详情（swagger 页面）

为了让你的前端应用能够访问到后端接口，你需要先在本地把 `CircleService` 运行起来。

**第一步：git 获取最新代码**

`team3-dev`分支

**第二步：运行 CircleService**

`CircleService` 是一个独立的服务，你需要单独运行它。

**方式一：使用 Visual Studio（推荐）**

1.  用 Visual Studio 打开根目录下的 `Database.sln` 解决方案文件。
2.  在右侧的 "解决方案资源管理器" 中，找到 `Services` -> `CircleService`。
3.  右键点击 `CircleService` 项目，选择 `设为启动项目`。
4.  点击顶部绿色的播放按钮 `▶` (可下拉选择"ISS Express"(建议首选) "Http" "Https") 来启动项目。

**方式二：使用命令行 (通用)**

1.  打开一个新的终端窗口。
2.  进入 `CircleService` 项目的目录：
    ```bash
    cd Services/CircleService
    ```
3.  运行以下命令来启动服务：
    ```bash
    dotnet run
    ```
4.  当看到类似下面的输出时，说明后端服务已经成功启动了：
    ```
    info: Microsoft.Hosting.Lifetime[14]
          Now listening on: https://localhost:7123
    info: Microsoft.Hosting.Lifetime[14]
          Now listening on: http://localhost:5123
    info: Microsoft.Hosting.Lifetime[0]
          Application started. Press Ctrl+C to shut down.
    ```
    **请记下这里的端口号**（比如 `http://localhost:5123`），这是你的前端应用需要访问的地址。

**第三步：访问 Swagger API 文档**

服务运行后，在浏览器中打开以下地址（vs2022 应该会自动跳转打开），可以查看所有可用的 API 接口及其详细信息：

- **Swagger UI**: [http://localhost:5123/swagger](http://localhost:5123/swagger)

_(请将 `5123` 替换为你的程序实际运行的 HTTP 端口号)_

在 Swagger 页面，你可以直接测试每一个接口，查看请求参数和返回结果

## 3. 核心 API 接口详解

以下是你开发前端页面时需要用到的核心 API 列表。

**重要提示**:

- **Base URL**: 所有接口的基础路径是 `http://localhost:5123` (请替换为你的实际端口)。
- **用户认证**: 目前为了方便测试，所有接口中的用户 ID (如 `userId`, `ownerId`) 都是在后端**硬编码**为 `1`。在后续的开发中，我们会通过 JWT Token 来自动获取当前登录用户的 ID。现阶段你**无需关心**用户认证问题。
- **响应格式**: 所有接口都会返回我们项目统一的 `BaseHttpResponse` 格式：
  ```json
  {
    "code": 0,         // 0 表示成功, 其他非零值表示失败
    "msg": "OK",       // 附加信息, 如成功时的 "OK" 或失败时的错误原因
    "data": { ... }    // 实际返回的数据内容, 可能是一个对象或一个数组
  }
  ```

### 3.1 圈子管理 (Circles)

#### **1. 获取所有圈子列表 (可带名称搜索)**

- **功能**: 用于在“圈子广场”页面显示所有公开的圈子。支持通过圈子名称进行模糊搜索。
- **URL**: `GET /api/circles`
- **查询参数 (Query Parameter)**:
  - `name` (可选, `string`): 输入要搜索的圈子名称关键字。如果不提供此参数，则返回所有圈子。
- **成功响应 (`200 OK`)**:
  ```json
  {
    "code": 0,
    "msg": "OK",
    "data": [
      {
        "circleId": 1,
        "name": "游戏爱好者之家",
        "description": "分享和讨论各种游戏的圈子",
        "ownerId": 1,
        "memberCount": 15 // 圈子当前的成员数量
      }
      // ... more circles
    ]
  }
  ```

#### **2. 创建新圈子**

- **功能**: 用于“创建圈子”页面。
- **URL**: `POST /api/circles`
- **请求体 (Request Body)**:
  ```json
  {
    "name": "一个新的圈子名称",
    "description": "这是一个详细的圈子描述"
  }
  ```
- **成功响应 (`200 OK`)**:
  ```json
  {
    "code": 0,
    "msg": "圈子创建成功",
    "data": {
      "circleId": 10,
      "name": "一个新的圈子名称",
      "description": "这是一个详细的圈子描述",
      "ownerId": 1,
      "memberCount": 1 // 创建者自动成为第一个成员
    }
  }
  ```

#### **3. 获取单个圈子的详细信息 (包含成员列表)**

- **功能**: 用于“圈子主页”，显示圈子的详细信息和所有成员列表。
- **URL**: `GET /api/circles/{id}`
- **路径参数 (Path Parameter)**:
  - `id` (必填, `int`): 要查询的圈子 ID。
- **成功响应 (`200 OK`)**:
  ```json
  {
    "code": 0,
    "msg": "OK",
    "data": {
      "circle": {
        "circleId": 1,
        "name": "游戏爱好者之家",
        "description": "分享和讨论各种游戏的圈子",
        "ownerId": 1,
        "memberCount": 15
      },
      "members": [
        {
          "userId": 1,
          "userName": "圈主张三", // 注意：userName 字段后续会从 UserDataService 获取，暂时可能为空
          "role": 0, // 0: Owner, 1: Admin, 2: Member
          "status": 1, // 0: Pending, 1: Approved, 2: Rejected
          "points": 100
        }
        // ... more members
      ]
    }
  }
  ```

#### **4. 删除圈子 (仅限圈主)**

- **功能**: 在圈子管理页面，允许圈主删除整个圈子。
- **URL**: `DELETE /api/circles/{id}`
- **路径参数 (Path Parameter)**:
  - `id` (必填, `int`): 要删除的圈子 ID。
- **成功响应 (`200 OK`)**:
  ```json
  {
    "code": 0,
    "msg": "圈子删除成功",
    "data": null
  }
  ```
- **失败响应 (`404 Not Found`)**: 如果圈子不存在，或当前用户不是圈主。

---

### 3.2 圈子成员管理 (Circle Membership)

#### **1. 申请加入圈子**

- **功能**: 用户在圈子页面点击“加入”按钮时调用。
- **URL**: `POST /api/circles/{id}/members/apply`
- **路径参数 (Path Parameter)**:
  - `id` (必填, `int`): 要申请加入的圈子 ID。
- **成功响应 (`200 OK`)**:
  ```json
  {
    "code": 0,
    "msg": "您的申请已提交，请等待圈主或管理员审核。",
    "data": null
  }
  ```

#### **2. 圈主/管理员处理入圈申请**

- **功能**: 在圈子管理页面，圈主/管理员“批准”或“拒绝”用户的入圈申请。
- **URL**: `PUT /api/circles/{id}/members/{userId}/approve`
- **路径参数 (Path Parameter)**:
  - `id` (必填, `int`): 圈子 ID。
  - `userId` (必填, `int`): 待处理的申请人用户 ID。
- **查询参数 (Query Parameter)**:
  - `approve` (必填, `boolean`): `true` 表示批准，`false` 表示拒绝。
- **成功响应 (`200 OK`)**:
  ```json
  {
    "code": 0,
    "msg": "操作成功",
    "data": null
  }
  ```

#### **3. 用户主动退出圈子**

- **功能**: 圈子成员点击“退出圈子”按钮。
- **URL**: `DELETE /api/circles/{id}/membership`
- **路径参数 (Path Parameter)**:
  - `id` (必填, `int`): 要退出的圈子 ID。
- **成功响应 (`200 OK`)**:
  ```json
  {
    "code": 0,
    "msg": "您已成功退出该圈子。",
    "data": null
  }
  ```
- **失败响应**: 如果用户是圈主，则无法退出。

---

### 3.3 活动管理 (Activities)

_(活动相关接口，可以先放一放，可能还需要做一些改动调整等圈子核心功能对接好后再处理)_

#### **1. 获取圈子内的所有活动**

- **URL**: `GET /api/circles/{circleId}/activities`

#### **2. 创建新活动 (圈主/管理员)**

- **URL**: `POST /api/circles/{circleId}/activities`

#### **3. 用户加入活动**

- **URL**: `POST /api/activities/{activityId}/participants/join`

---
